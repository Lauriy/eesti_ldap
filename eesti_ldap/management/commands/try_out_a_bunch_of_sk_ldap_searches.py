import ast
import datetime
import json
from math import ceil
from time import sleep

from django.core.management.base import BaseCommand

from eesti_ldap.models import SkEeLdapQuery, Person, BirthDate
from eesti_ldap.sk_ldap_client import SkLdapClient
from django.conf import settings


# TODO: Run a similar task with Celery beat every 24 hours that queues smaller 'ask LDAP' tasks 1 every 10 seconds with an expiry of 23 hours 59 minutes
class Command(BaseCommand):
    help = 'Uses our client to search ldap.sk.ee for a set of personal codes to determine how quick we get banned'

    def handle(self, *args, **options):
        birthdate, created = BirthDate.objects.get_or_create(actual_date=datetime.date(year=1990, month=4, day=2))
        personal_codes = ['39004020000', '39004020011', '39004020022', '39004020033', '39004020044', '39004020055',
                          '39004020066', '39004020077', '39004020088', '39004020099', '39004020109', '39004020118',
                          '39004020120', '39004020131', '39004020142', '39004020153', '39004020164', '39004020175',
                          '39004020186', '39004020197', '39004020207', '39004020218', '39004020229', '39004020235',
                          '39004020240', '39004020251', '39004020262', '39004020273', '39004020284', '39004020295',
                          '39004020305', '39004020316', '39004020327', '39004020338', '39004020349', '39004020352',
                          '39004020360', '39004020371', '39004020382', '39004020393', '39004020403', '39004020414',
                          '39004020425', '39004020436', '39004020447', '39004020458', '39004020469', '39004020470',
                          '39004020480', '39004020491', '39004020501', '39004020512', '39004020523', '39004020534',
                          '39004020545', '39004020556', '39004020567', '39004020578', '39004020589', '39004020597',
                          '39004020604', '39004020610', '39004020621', '39004020632', '39004020643', '39004020654',
                          '39004020665', '39004020676', '39004020687', '39004020698', '39004020708', '39004020719',
                          '39004020721', '39004020730', '39004020741', '39004020752', '39004020763', '39004020774',
                          '39004020785', '39004020796', '39004020806', '39004020817', '39004020828', '39004020839',
                          '39004020849', '39004020850', '39004020861', '39004020872', '39004020883', '39004020894',
                          '39004020904', '39004020915', '39004020926', '39004020937', '39004020948', '39004020959',
                          '39004020966', '39004020970', '39004020981', '39004020992', '39004021008', '39004021019',
                          '39004021020', '39004021030', '39004021041', '39004021052', '39004021063', '39004021074',
                          '39004021085', '39004021096', '39004021106', '39004021117', '39004021128', '39004021139',
                          '39004021147', '39004021150', '39004021161', '39004021172', '39004021183', '39004021194',
                          '39004021204', '39004021215', '39004021226', '39004021237', '39004021248', '39004021259',
                          '39004021264', '39004021270', '39004021281', '39004021292', '39004021302', '39004021313',
                          '39004021324', '39004021335', '39004021346', '39004021357', '39004021368', '39004021379',
                          '39004021381', '39004021390', '39004021400', '39004021411', '39004021422', '39004021433',
                          '39004021444', '39004021455', '39004021466', '39004021477', '39004021488', '39004021499',
                          '39004021509', '39004021516', '39004021520', '39004021531', '39004021542', '39004021553',
                          '39004021564', '39004021575', '39004021586', '39004021597', '39004021607', '39004021618',
                          '39004021629', '39004021633', '39004021640', '39004021651', '39004021662', '39004021673',
                          '39004021684', '39004021695', '39004021705', '39004021716', '39004021727', '39004021738',
                          '39004021749', '39004021750', '39004021760', '39004021771', '39004021782', '39004021793',
                          '39004021803', '39004021814', '39004021825', '39004021836', '39004021847', '39004021858',
                          '39004021869', '39004021878', '39004021880', '39004021891', '39004021901', '39004021912',
                          '39004021923', '39004021934', '39004021945', '39004021956', '39004021967', '39004021978',
                          '39004021989', '39004021995', '39004022005', '39004022016', '39004022027', '39004022038',
                          '39004022049', '39004022059', '39004022060', '39004022071', '39004022082', '39004022093',
                          '39004022103', '39004022114', '39004022125', '39004022136', '39004022147', '39004022158',
                          '39004022169', '39004022176', '39004022180', '39004022191', '39004022201', '39004022212',
                          '39004022223', '39004022234', '39004022245', '39004022256', '39004022267', '39004022278',
                          '39004022289', '39004022293', '39004022300', '39004022310', '39004022321', '39004022332',
                          '39004022343', '39004022354', '39004022365', '39004022376', '39004022387', '39004022398',
                          '39004022408', '39004022419', '39004022428', '39004022430', '39004022441', '39004022452',
                          '39004022463', '39004022474', '39004022485', '39004022496', '39004022506', '39004022517',
                          '39004022528', '39004022539', '39004022545', '39004022550', '39004022561', '39004022572',
                          '39004022583', '39004022594', '39004022604', '39004022615', '39004022626', '39004022637',
                          '39004022648', '39004022659', '39004022662', '39004022670', '39004022681', '39004022692',
                          '39004022702', '39004022713', '39004022724', '39004022735', '39004022746', '39004022757',
                          '39004022768', '39004022779', '39004022780', '39004022790', '39004022800', '39004022811',
                          '39004022822', '39004022833', '39004022844', '39004022855', '39004022866', '39004022877',
                          '39004022888', '39004022899', '39004022909', '39004022914', '39004022920', '39004022931',
                          '39004022942', '39004022953', '39004022964', '39004022975', '39004022986', '39004022997',
                          '39004023002', '39004023013', '39004023024', '39004023035', '39004023046', '39004023057',
                          '39004023068', '39004023079', '39004023088', '39004023090', '39004023100', '39004023111',
                          '39004023122', '39004023133', '39004023144', '39004023155', '39004023166', '39004023177',
                          '39004023188', '39004023199', '39004023209', '39004023212', '39004023220', '39004023231',
                          '39004023242', '39004023253', '39004023264', '39004023275', '39004023286', '39004023297',
                          '39004023307', '39004023318', '39004023329', '39004023330', '39004023340', '39004023351',
                          '39004023362', '39004023373', '39004023384', '39004023395', '39004023405', '39004023416',
                          '39004023427', '39004023438', '39004023449', '39004023457', '39004023460', '39004023471',
                          '39004023482', '39004023493', '39004023503', '39004023514', '39004023525', '39004023536',
                          '39004023547', '39004023558', '39004023569', '39004023574', '39004023580', '39004023591',
                          '39004023601', '39004023612', '39004023623', '39004023634', '39004023645', '39004023656',
                          '39004023667', '39004023678', '39004023689', '39004023691', '39004023709', '39004023710',
                          '39004023721', '39004023732', '39004023743', '39004023754', '39004023765', '39004023776',
                          '39004023787', '39004023798', '39004023808', '39004023819', '39004023826', '39004023830',
                          '39004023841', '39004023852', '39004023863', '39004023874', '39004023885', '39004023896',
                          '39004023906', '39004023917', '39004023928', '39004023939', '39004023943', '39004023950',
                          '39004023961', '39004023972', '39004023983', '39004023994', '39004024007', '39004024010',
                          '39004024021', '39004024032', '39004024043', '39004024054', '39004024065', '39004024076',
                          '39004024087', '39004024098', '39004024108', '39004024119', '39004024124', '39004024130',
                          '39004024141', '39004024152', '39004024163', '39004024174', '39004024185', '39004024196',
                          '39004024206', '39004024217', '39004024228', '39004024239', '39004024241', '39004024250',
                          '39004024261', '39004024272', '39004024283', '39004024294', '39004024304', '39004024315',
                          '39004024326', '39004024337', '39004024348', '39004024359', '39004024369', '39004024370',
                          '39004024381', '39004024392', '39004024402', '39004024413', '39004024424', '39004024435',
                          '39004024446', '39004024457', '39004024468', '39004024479', '39004024486', '39004024490',
                          '39004024500', '39004024511', '39004024522', '39004024533', '39004024544', '39004024555',
                          '39004024566', '39004024577', '39004024588', '39004024599', '39004024609', '39004024610',
                          '39004024620', '39004024631', '39004024642', '39004024653', '39004024664', '39004024675',
                          '39004024686', '39004024697', '39004024707', '39004024718', '39004024729', '39004024738',
                          '39004024740', '39004024751', '39004024762', '39004024773', '39004024784', '39004024795',
                          '39004024805', '39004024816', '39004024827', '39004024838', '39004024849', '39004024855',
                          '39004024860', '39004024871', '39004024882', '39004024893', '39004024903', '39004024914',
                          '39004024925', '39004024936', '39004024947', '39004024958', '39004024969', '39004024972',
                          '39004024980', '39004024991', '39004025007', '39004025018', '39004025029', '39004025036',
                          '39004025040', '39004025051', '39004025062', '39004025073', '39004025084', '39004025095',
                          '39004025105', '39004025116', '39004025127', '39004025138', '39004025149', '39004025153',
                          '39004025160', '39004025171', '39004025182', '39004025193', '39004025203', '39004025214',
                          '39004025225', '39004025236', '39004025247', '39004025258', '39004025269', '39004025270',
                          '39004025280', '39004025291', '39004025301', '39004025312', '39004025323', '39004025334',
                          '39004025345', '39004025356', '39004025367', '39004025378', '39004025389', '39004025398',
                          '39004025405', '39004025410', '39004025421', '39004025432', '39004025443', '39004025454',
                          '39004025465', '39004025476', '39004025487', '39004025498', '39004025508', '39004025519',
                          '39004025522', '39004025530', '39004025541', '39004025552', '39004025563', '39004025574',
                          '39004025585', '39004025596', '39004025606', '39004025617', '39004025628', '39004025639',
                          '39004025640', '39004025650', '39004025661', '39004025672', '39004025683', '39004025694',
                          '39004025704', '39004025715', '39004025726', '39004025737', '39004025748', '39004025759',
                          '39004025767', '39004025770', '39004025781', '39004025792', '39004025802', '39004025813',
                          '39004025824', '39004025835', '39004025846', '39004025857', '39004025868', '39004025879',
                          '39004025884', '39004025890', '39004025900', '39004025911', '39004025922', '39004025933',
                          '39004025944', '39004025955', '39004025966', '39004025977', '39004025988', '39004025999',
                          '39004026004', '39004026015', '39004026026', '39004026037', '39004026048', '39004026059',
                          '39004026065', '39004026070', '39004026081', '39004026092', '39004026102', '39004026113',
                          '39004026124', '39004026135', '39004026146', '39004026157', '39004026168', '39004026179',
                          '39004026182', '39004026190', '39004026200', '39004026211', '39004026222', '39004026233',
                          '39004026244', '39004026255', '39004026266', '39004026277', '39004026288', '39004026299',
                          '39004026309', '39004026317', '39004026320', '39004026331', '39004026342', '39004026353',
                          '39004026364', '39004026375', '39004026386', '39004026397', '39004026407', '39004026418',
                          '39004026429', '39004026434', '39004026440', '39004026451', '39004026462', '39004026473',
                          '39004026484', '39004026495', '39004026505', '39004026516', '39004026527', '39004026538',
                          '39004026549', '39004026551', '39004026560', '39004026571', '39004026582', '39004026593',
                          '39004026603', '39004026614', '39004026625', '39004026636', '39004026647', '39004026658',
                          '39004026669', '39004026679', '39004026680', '39004026691', '39004026701', '39004026712',
                          '39004026723', '39004026734', '39004026745', '39004026756', '39004026767', '39004026778',
                          '39004026789', '39004026796', '39004026803', '39004026810', '39004026821', '39004026832',
                          '39004026843', '39004026854', '39004026865', '39004026876', '39004026887', '39004026898',
                          '39004026908', '39004026919', '39004026920', '39004026930', '39004026941', '39004026952',
                          '39004026963', '39004026974', '39004026985', '39004026996', '39004027001', '39004027012',
                          '39004027023', '39004027034', '39004027045', '39004027056', '39004027067', '39004027078',
                          '39004027089', '39004027094', '39004027101', '39004027110', '39004027121', '39004027132',
                          '39004027143', '39004027154', '39004027165', '39004027176', '39004027187', '39004027198',
                          '39004027208', '39004027219', '39004027229', '39004027230', '39004027241', '39004027252',
                          '39004027263', '39004027274', '39004027285', '39004027296', '39004027306', '39004027317',
                          '39004027328', '39004027339', '39004027346', '39004027350', '39004027361', '39004027372',
                          '39004027383', '39004027394', '39004027404', '39004027415', '39004027426', '39004027437',
                          '39004027448', '39004027459', '39004027463', '39004027470', '39004027481', '39004027492',
                          '39004027502', '39004027513', '39004027524', '39004027535', '39004027546', '39004027557',
                          '39004027568', '39004027579', '39004027580', '39004027590', '39004027600', '39004027611',
                          '39004027622', '39004027633', '39004027644', '39004027655', '39004027666', '39004027677',
                          '39004027688', '39004027699', '39004027709', '39004027715', '39004027720', '39004027731',
                          '39004027742', '39004027753', '39004027764', '39004027775', '39004027786', '39004027797',
                          '39004027807', '39004027818', '39004027829', '39004027832', '39004027840', '39004027851',
                          '39004027862', '39004027873', '39004027884', '39004027895', '39004027905', '39004027916',
                          '39004027927', '39004027938', '39004027949', '39004027950', '39004027960', '39004027971',
                          '39004027982', '39004027993', '39004028009', '39004028013', '39004028020', '39004028031',
                          '39004028042', '39004028053', '39004028064', '39004028075', '39004028086', '39004028097',
                          '39004028107', '39004028118', '39004028129', '39004028130', '39004028140', '39004028151',
                          '39004028162', '39004028173', '39004028184', '39004028195', '39004028205', '39004028216',
                          '39004028227', '39004028238', '39004028249', '39004028258', '39004028260', '39004028271',
                          '39004028282', '39004028293', '39004028303', '39004028314', '39004028325', '39004028336',
                          '39004028347', '39004028358', '39004028369', '39004028375', '39004028380', '39004028391',
                          '39004028401', '39004028412', '39004028423', '39004028434', '39004028445', '39004028456',
                          '39004028467', '39004028478', '39004028489', '39004028492', '39004028500', '39004028510',
                          '39004028521', '39004028532', '39004028543', '39004028554', '39004028565', '39004028576',
                          '39004028587', '39004028598', '39004028608', '39004028619', '39004028627', '39004028630',
                          '39004028641', '39004028652', '39004028663', '39004028674', '39004028685', '39004028696',
                          '39004028706', '39004028717', '39004028728', '39004028739', '39004028744', '39004028750',
                          '39004028761', '39004028772', '39004028783', '39004028794', '39004028804', '39004028815',
                          '39004028826', '39004028837', '39004028848', '39004028859', '39004028861', '39004028870',
                          '39004028881', '39004028892', '39004028902', '39004028913', '39004028924', '39004028935',
                          '39004028946', '39004028957', '39004028968', '39004028979', '39004028989', '39004028990',
                          '39004029006', '39004029017', '39004029028', '39004029039', '39004029042', '39004029050',
                          '39004029061', '39004029072', '39004029083', '39004029094', '39004029104', '39004029115',
                          '39004029126', '39004029137', '39004029148', '39004029159', '39004029160', '39004029170',
                          '39004029181', '39004029192', '39004029202', '39004029213', '39004029224', '39004029235',
                          '39004029246', '39004029257', '39004029268', '39004029279', '39004029287', '39004029290',
                          '39004029300', '39004029311', '39004029322', '39004029333', '39004029344', '39004029355',
                          '39004029366', '39004029377', '39004029388', '39004029399', '39004029409', '39004029411',
                          '39004029420', '39004029431', '39004029442', '39004029453', '39004029464', '39004029475',
                          '39004029486', '39004029497', '39004029507', '39004029518', '39004029529', '39004029539',
                          '39004029540', '39004029551', '39004029562', '39004029573', '39004029584', '39004029595',
                          '39004029605', '39004029616', '39004029627', '39004029638', '39004029649', '39004029656',
                          '39004029660', '39004029671', '39004029682', '39004029693', '39004029703', '39004029714',
                          '39004029725', '39004029736', '39004029747', '39004029758', '39004029769', '39004029773',
                          '39004029780', '39004029791', '39004029801', '39004029812', '39004029823', '39004029834',
                          '39004029845', '39004029856', '39004029867', '39004029878', '39004029889', '39004029890',
                          '39004029908', '39004029910', '39004029921', '39004029932', '39004029943', '39004029954',
                          '39004029965', '39004029976', '39004029987', '39004029998', '49004020001', '49004020012',
                          '49004020023', '49004020034', '49004020045', '49004020056', '49004020067', '49004020078',
                          '49004020089', '49004020090', '49004020108', '49004020110', '49004020121', '49004020132',
                          '49004020143', '49004020154', '49004020165', '49004020176', '49004020187', '49004020198',
                          '49004020208', '49004020219', '49004020225', '49004020230', '49004020241', '49004020252',
                          '49004020263', '49004020274', '49004020285', '49004020296', '49004020306', '49004020317',
                          '49004020328', '49004020339', '49004020342', '49004020350', '49004020361', '49004020372',
                          '49004020383', '49004020394', '49004020404', '49004020415', '49004020426', '49004020437',
                          '49004020448', '49004020459', '49004020460', '49004020470', '49004020481', '49004020492',
                          '49004020502', '49004020513', '49004020524', '49004020535', '49004020546', '49004020557',
                          '49004020568', '49004020579', '49004020587', '49004020590', '49004020600', '49004020611',
                          '49004020622', '49004020633', '49004020644', '49004020655', '49004020666', '49004020677',
                          '49004020688', '49004020699', '49004020709', '49004020711', '49004020720', '49004020731',
                          '49004020742', '49004020753', '49004020764', '49004020775', '49004020786', '49004020797',
                          '49004020807', '49004020818', '49004020829', '49004020839', '49004020840', '49004020851',
                          '49004020862', '49004020873', '49004020884', '49004020895', '49004020905', '49004020916',
                          '49004020927', '49004020938', '49004020949', '49004020956', '49004020960', '49004020971',
                          '49004020982', '49004020993', '49004021009', '49004021010', '49004021020', '49004021031',
                          '49004021042', '49004021053', '49004021064', '49004021075', '49004021086', '49004021097',
                          '49004021107', '49004021118', '49004021129', '49004021137', '49004021140', '49004021151',
                          '49004021162', '49004021173', '49004021184', '49004021195', '49004021205', '49004021216',
                          '49004021227', '49004021238', '49004021249', '49004021254', '49004021260', '49004021271',
                          '49004021282', '49004021293', '49004021303', '49004021314', '49004021325', '49004021336',
                          '49004021347', '49004021358', '49004021369', '49004021371', '49004021380', '49004021391',
                          '49004021401', '49004021412', '49004021423', '49004021434', '49004021445', '49004021456',
                          '49004021467', '49004021478', '49004021489', '49004021499', '49004021506', '49004021510',
                          '49004021521', '49004021532', '49004021543', '49004021554', '49004021565', '49004021576',
                          '49004021587', '49004021598', '49004021608', '49004021619', '49004021623', '49004021630',
                          '49004021641', '49004021652', '49004021663', '49004021674', '49004021685', '49004021696',
                          '49004021706', '49004021717', '49004021728', '49004021739', '49004021740', '49004021750',
                          '49004021761', '49004021772', '49004021783', '49004021794', '49004021804', '49004021815',
                          '49004021826', '49004021837', '49004021848', '49004021859', '49004021868', '49004021870',
                          '49004021881', '49004021892', '49004021902', '49004021913', '49004021924', '49004021935',
                          '49004021946', '49004021957', '49004021968', '49004021979', '49004021985', '49004021990',
                          '49004022006', '49004022017', '49004022028', '49004022039', '49004022049', '49004022050',
                          '49004022061', '49004022072', '49004022083', '49004022094', '49004022104', '49004022115',
                          '49004022126', '49004022137', '49004022148', '49004022159', '49004022166', '49004022170',
                          '49004022181', '49004022192', '49004022202', '49004022213', '49004022224', '49004022235',
                          '49004022246', '49004022257', '49004022268', '49004022279', '49004022283', '49004022290',
                          '49004022300', '49004022311', '49004022322', '49004022333', '49004022344', '49004022355',
                          '49004022366', '49004022377', '49004022388', '49004022399', '49004022409', '49004022418',
                          '49004022420', '49004022431', '49004022442', '49004022453', '49004022464', '49004022475',
                          '49004022486', '49004022497', '49004022507', '49004022518', '49004022529', '49004022535',
                          '49004022540', '49004022551', '49004022562', '49004022573', '49004022584', '49004022595',
                          '49004022605', '49004022616', '49004022627', '49004022638', '49004022649', '49004022652',
                          '49004022660', '49004022671', '49004022682', '49004022693', '49004022703', '49004022714',
                          '49004022725', '49004022736', '49004022747', '49004022758', '49004022769', '49004022770',
                          '49004022780', '49004022791', '49004022801', '49004022812', '49004022823', '49004022834',
                          '49004022845', '49004022856', '49004022867', '49004022878', '49004022889', '49004022897',
                          '49004022904', '49004022910', '49004022921', '49004022932', '49004022943', '49004022954',
                          '49004022965', '49004022976', '49004022987', '49004022998', '49004023003', '49004023014',
                          '49004023025', '49004023036', '49004023047', '49004023058', '49004023069', '49004023078',
                          '49004023080', '49004023091', '49004023101', '49004023112', '49004023123', '49004023134',
                          '49004023145', '49004023156', '49004023167', '49004023178', '49004023189', '49004023195',
                          '49004023202', '49004023210', '49004023221', '49004023232', '49004023243', '49004023254',
                          '49004023265', '49004023276', '49004023287', '49004023298', '49004023308', '49004023319',
                          '49004023320', '49004023330', '49004023341', '49004023352', '49004023363', '49004023374',
                          '49004023385', '49004023396', '49004023406', '49004023417', '49004023428', '49004023439',
                          '49004023447', '49004023450', '49004023461', '49004023472', '49004023483', '49004023494',
                          '49004023504', '49004023515', '49004023526', '49004023537', '49004023548', '49004023559',
                          '49004023564', '49004023570', '49004023581', '49004023592', '49004023602', '49004023613',
                          '49004023624', '49004023635', '49004023646', '49004023657', '49004023668', '49004023679',
                          '49004023681', '49004023690', '49004023700', '49004023711', '49004023722', '49004023733',
                          '49004023744', '49004023755', '49004023766', '49004023777', '49004023788', '49004023799',
                          '49004023809', '49004023816', '49004023820', '49004023831', '49004023842', '49004023853',
                          '49004023864', '49004023875', '49004023886', '49004023897', '49004023907', '49004023918',
                          '49004023929', '49004023933', '49004023940', '49004023951', '49004023962', '49004023973',
                          '49004023984', '49004023995', '49004024000', '49004024011', '49004024022', '49004024033',
                          '49004024044', '49004024055', '49004024066', '49004024077', '49004024088', '49004024099',
                          '49004024109', '49004024114', '49004024120', '49004024131', '49004024142', '49004024153',
                          '49004024164', '49004024175', '49004024186', '49004024197', '49004024207', '49004024218',
                          '49004024229', '49004024231', '49004024240', '49004024251', '49004024262', '49004024273',
                          '49004024284', '49004024295', '49004024305', '49004024316', '49004024327', '49004024338',
                          '49004024349', '49004024359', '49004024360', '49004024371', '49004024382', '49004024393',
                          '49004024403', '49004024414', '49004024425', '49004024436', '49004024447', '49004024458',
                          '49004024469', '49004024476', '49004024480', '49004024491', '49004024501', '49004024512',
                          '49004024523', '49004024534', '49004024545', '49004024556', '49004024567', '49004024578',
                          '49004024589', '49004024593', '49004024600', '49004024610', '49004024621', '49004024632',
                          '49004024643', '49004024654', '49004024665', '49004024676', '49004024687', '49004024698',
                          '49004024708', '49004024719', '49004024728', '49004024730', '49004024741', '49004024752',
                          '49004024763', '49004024774', '49004024785', '49004024796', '49004024806', '49004024817',
                          '49004024828', '49004024839', '49004024845', '49004024850', '49004024861', '49004024872',
                          '49004024883', '49004024894', '49004024904', '49004024915', '49004024926', '49004024937',
                          '49004024948', '49004024959', '49004024962', '49004024970', '49004024981', '49004024992',
                          '49004025008', '49004025019', '49004025026', '49004025030', '49004025041', '49004025052',
                          '49004025063', '49004025074', '49004025085', '49004025096', '49004025106', '49004025117',
                          '49004025128', '49004025139', '49004025143', '49004025150', '49004025161', '49004025172',
                          '49004025183', '49004025194', '49004025204', '49004025215', '49004025226', '49004025237',
                          '49004025248', '49004025259', '49004025260', '49004025270', '49004025281', '49004025292',
                          '49004025302', '49004025313', '49004025324', '49004025335', '49004025346', '49004025357',
                          '49004025368', '49004025379', '49004025388', '49004025390', '49004025400', '49004025411',
                          '49004025422', '49004025433', '49004025444', '49004025455', '49004025466', '49004025477',
                          '49004025488', '49004025499', '49004025509', '49004025512', '49004025520', '49004025531',
                          '49004025542', '49004025553', '49004025564', '49004025575', '49004025586', '49004025597',
                          '49004025607', '49004025618', '49004025629', '49004025630', '49004025640', '49004025651',
                          '49004025662', '49004025673', '49004025684', '49004025695', '49004025705', '49004025716',
                          '49004025727', '49004025738', '49004025749', '49004025757', '49004025760', '49004025771',
                          '49004025782', '49004025793', '49004025803', '49004025814', '49004025825', '49004025836',
                          '49004025847', '49004025858', '49004025869', '49004025874', '49004025880', '49004025891',
                          '49004025901', '49004025912', '49004025923', '49004025934', '49004025945', '49004025956',
                          '49004025967', '49004025978', '49004025989', '49004025991', '49004026005', '49004026016',
                          '49004026027', '49004026038', '49004026049', '49004026055', '49004026060', '49004026071',
                          '49004026082', '49004026093', '49004026103', '49004026114', '49004026125', '49004026136',
                          '49004026147', '49004026158', '49004026169', '49004026172', '49004026180', '49004026191',
                          '49004026201', '49004026212', '49004026223', '49004026234', '49004026245', '49004026256',
                          '49004026267', '49004026278', '49004026289', '49004026290', '49004026307', '49004026310',
                          '49004026321', '49004026332', '49004026343', '49004026354', '49004026365', '49004026376',
                          '49004026387', '49004026398', '49004026408', '49004026419', '49004026424', '49004026430',
                          '49004026441', '49004026452', '49004026463', '49004026474', '49004026485', '49004026496',
                          '49004026506', '49004026517', '49004026528', '49004026539', '49004026541', '49004026550',
                          '49004026561', '49004026572', '49004026583', '49004026594', '49004026604', '49004026615',
                          '49004026626', '49004026637', '49004026648', '49004026659', '49004026669', '49004026670',
                          '49004026681', '49004026692', '49004026702', '49004026713', '49004026724', '49004026735',
                          '49004026746', '49004026757', '49004026768', '49004026779', '49004026786', '49004026790',
                          '49004026800', '49004026811', '49004026822', '49004026833', '49004026844', '49004026855',
                          '49004026866', '49004026877', '49004026888', '49004026899', '49004026909', '49004026910',
                          '49004026920', '49004026931', '49004026942', '49004026953', '49004026964', '49004026975',
                          '49004026986', '49004026997', '49004027002', '49004027013', '49004027024', '49004027035',
                          '49004027046', '49004027057', '49004027068', '49004027079', '49004027084', '49004027090',
                          '49004027100', '49004027111', '49004027122', '49004027133', '49004027144', '49004027155',
                          '49004027166', '49004027177', '49004027188', '49004027199', '49004027209', '49004027219',
                          '49004027220', '49004027231', '49004027242', '49004027253', '49004027264', '49004027275',
                          '49004027286', '49004027297', '49004027307', '49004027318', '49004027329', '49004027336',
                          '49004027340', '49004027351', '49004027362', '49004027373', '49004027384', '49004027395',
                          '49004027405', '49004027416', '49004027427', '49004027438', '49004027449', '49004027453',
                          '49004027460', '49004027471', '49004027482', '49004027493', '49004027503', '49004027514',
                          '49004027525', '49004027536', '49004027547', '49004027558', '49004027569', '49004027570',
                          '49004027580', '49004027591', '49004027601', '49004027612', '49004027623', '49004027634',
                          '49004027645', '49004027656', '49004027667', '49004027678', '49004027689', '49004027698',
                          '49004027705', '49004027710', '49004027721', '49004027732', '49004027743', '49004027754',
                          '49004027765', '49004027776', '49004027787', '49004027798', '49004027808', '49004027819',
                          '49004027822', '49004027830', '49004027841', '49004027852', '49004027863', '49004027874',
                          '49004027885', '49004027896', '49004027906', '49004027917', '49004027928', '49004027939',
                          '49004027940', '49004027950', '49004027961', '49004027972', '49004027983', '49004027994',
                          '49004028003', '49004028010', '49004028021', '49004028032', '49004028043', '49004028054',
                          '49004028065', '49004028076', '49004028087', '49004028098', '49004028108', '49004028119',
                          '49004028120', '49004028130', '49004028141', '49004028152', '49004028163', '49004028174',
                          '49004028185', '49004028196', '49004028206', '49004028217', '49004028228', '49004028239',
                          '49004028248', '49004028250', '49004028261', '49004028272', '49004028283', '49004028294',
                          '49004028304', '49004028315', '49004028326', '49004028337', '49004028348', '49004028359',
                          '49004028365', '49004028370', '49004028381', '49004028392', '49004028402', '49004028413',
                          '49004028424', '49004028435', '49004028446', '49004028457', '49004028468', '49004028479',
                          '49004028482', '49004028490', '49004028500', '49004028511', '49004028522', '49004028533',
                          '49004028544', '49004028555', '49004028566', '49004028577', '49004028588', '49004028599',
                          '49004028609', '49004028617', '49004028620', '49004028631', '49004028642', '49004028653',
                          '49004028664', '49004028675', '49004028686', '49004028697', '49004028707', '49004028718',
                          '49004028729', '49004028734', '49004028740', '49004028751', '49004028762', '49004028773',
                          '49004028784', '49004028795', '49004028805', '49004028816', '49004028827', '49004028838',
                          '49004028849', '49004028851', '49004028860', '49004028871', '49004028882', '49004028893',
                          '49004028903', '49004028914', '49004028925', '49004028936', '49004028947', '49004028958',
                          '49004028969', '49004028979', '49004028980', '49004028991', '49004029007', '49004029018',
                          '49004029029', '49004029032', '49004029040', '49004029051', '49004029062', '49004029073',
                          '49004029084', '49004029095', '49004029105', '49004029116', '49004029127', '49004029138',
                          '49004029149', '49004029150', '49004029160', '49004029171', '49004029182', '49004029193',
                          '49004029203', '49004029214', '49004029225', '49004029236', '49004029247', '49004029258',
                          '49004029269', '49004029277', '49004029280', '49004029291', '49004029301', '49004029312',
                          '49004029323', '49004029334', '49004029345', '49004029356', '49004029367', '49004029378',
                          '49004029389', '49004029394', '49004029401', '49004029410', '49004029421', '49004029432',
                          '49004029443', '49004029454', '49004029465', '49004029476', '49004029487', '49004029498',
                          '49004029508', '49004029519', '49004029529', '49004029530', '49004029541', '49004029552',
                          '49004029563', '49004029574', '49004029585', '49004029596', '49004029606', '49004029617',
                          '49004029628', '49004029639', '49004029646', '49004029650', '49004029661', '49004029672',
                          '49004029683', '49004029694', '49004029704', '49004029715', '49004029726', '49004029737',
                          '49004029748', '49004029759', '49004029763', '49004029770', '49004029781', '49004029792',
                          '49004029802', '49004029813', '49004029824', '49004029835', '49004029846', '49004029857',
                          '49004029868', '49004029879', '49004029880', '49004029890', '49004029900', '49004029911',
                          '49004029922', '49004029933', '49004029944', '49004029955', '49004029966', '49004029977',
                          '49004029988', '49004029999']
        client = SkLdapClient()
        personal_codes.sort()
        page = 0
        page_size = settings.SK_LDAP_MAX_PAGE_SIZE
        max_page = ceil(float(len(personal_codes)) / float(page_size))
        while page < max_page:
            codes_to_ask_about = personal_codes[page * page_size:(page + 1) * page_size]
            cached, created = SkEeLdapQuery.objects.get_or_create(input=', '.join(codes_to_ask_about))
            if cached.response is None:
                result = str(client.search_for_personal_codes(codes_to_ask_about))
                cached.response = json.dumps(result)
                cached.save()
                sleep(10)
            else:
                result = json.loads(cached.response)
            for entry in ast.literal_eval(result):
                person_data = entry[1]['cn'][0].decode('utf-8').split(',')
                first_name_parts = person_data[1].split(' ')
                first_name = ' '.join([x.capitalize() for x in first_name_parts])
                last_name_parts = person_data[0].split(' ')
                last_name = ' '.join([x.capitalize() for x in last_name_parts])
                person, created = Person.objects.get_or_create(personal_code=person_data[2], birth_date=birthdate)
                if created:
                    person.first_name = first_name
                    person.last_name = last_name
                    person.save()
            page += 1
